<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:HaircutHistoryApp.ViewModels"
             x:Class="HaircutHistoryApp.Views.AddEditProfilePage"
             x:DataType="vm:AddEditProfileViewModel"
             Title="{Binding Title}"
             BackgroundColor="{AppThemeBinding Light={StaticResource BackgroundLight}, Dark={StaticResource BackgroundDark}}">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Save" Command="{Binding SaveCommand}"/>
    </ContentPage.ToolbarItems>

    <ScrollView>
        <VerticalStackLayout Padding="15" Spacing="20">

            <!-- Avatar Section -->
            <Frame Padding="15"
                   BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceLight}, Dark={StaticResource SurfaceDark}}"
                   BorderColor="Transparent"
                   CornerRadius="12">
                <VerticalStackLayout Spacing="15" HorizontalOptions="Center">
                    <Label Text="Profile Photo"
                           FontSize="18"
                           FontAttributes="Bold"
                           HorizontalOptions="Center"
                           TextColor="{AppThemeBinding Light={StaticResource TextPrimaryLight}, Dark={StaticResource TextPrimaryDark}}"/>

                    <!-- Avatar Preview -->
                    <Border StrokeShape="RoundRectangle 60"
                            Stroke="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray700}}"
                            BackgroundColor="{StaticResource Primary}"
                            WidthRequest="120"
                            HeightRequest="120"
                            HorizontalOptions="Center">
                        <Grid>
                            <Image Source="{Binding AvatarUrl}"
                                   Aspect="AspectFill"
                                   IsVisible="{Binding AvatarUrl, Converter={StaticResource StringToBoolConverter}}"/>
                            <Label Text="{Binding AvatarInitials}"
                                   FontSize="40"
                                   FontAttributes="Bold"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"
                                   TextColor="White"
                                   IsVisible="{Binding AvatarUrl, Converter={StaticResource StringToBoolConverter}, ConverterParameter=invert}"/>
                        </Grid>
                    </Border>

                    <!-- Photo Buttons -->
                    <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                        <Button Text="Take Photo"
                                Command="{Binding TakePhotoCommand}"
                                Style="{StaticResource SecondaryButton}"/>
                        <Button Text="Gallery"
                                Command="{Binding PickPhotoCommand}"
                                Style="{StaticResource SecondaryButton}"/>
                    </HorizontalStackLayout>

                    <Button Text="Remove Photo"
                            Command="{Binding RemovePhotoCommand}"
                            IsVisible="{Binding AvatarUrl, Converter={StaticResource StringToBoolConverter}}"
                            Style="{StaticResource DangerButton}"
                            HorizontalOptions="Center"/>
                </VerticalStackLayout>
            </Frame>

            <!-- Name Section -->
            <Frame Padding="15"
                   BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceLight}, Dark={StaticResource SurfaceDark}}"
                   BorderColor="Transparent"
                   CornerRadius="12">
                <VerticalStackLayout Spacing="15">
                    <Label Text="Profile Name"
                           FontSize="18"
                           FontAttributes="Bold"
                           TextColor="{AppThemeBinding Light={StaticResource TextPrimaryLight}, Dark={StaticResource TextPrimaryDark}}"/>

                    <VerticalStackLayout Spacing="5">
                        <Label Text="Name *"
                               FontSize="14"
                               TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}"/>
                        <Entry Placeholder="e.g., Me, Son, Daughter, Dad"
                               Text="{Binding Name}"
                               Style="{StaticResource EntryStyle}"/>
                        <Label Text="This is the person whose haircuts you want to track"
                               FontSize="12"
                               TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}"/>
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <!-- Save/Cancel Buttons -->
            <HorizontalStackLayout Spacing="15" HorizontalOptions="Center" Margin="0,10,0,30">
                <Button Text="Cancel"
                        Command="{Binding CancelCommand}"
                        Style="{StaticResource SecondaryButton}"
                        WidthRequest="120"/>
                <Button Text="Save Profile"
                        Command="{Binding SaveCommand}"
                        Style="{StaticResource PrimaryButton}"
                        WidthRequest="140"/>
            </HorizontalStackLayout>

            <!-- Loading -->
            <ActivityIndicator IsRunning="{Binding IsBusy}"
                               IsVisible="{Binding IsBusy}"
                               Color="{StaticResource Primary}"
                               HorizontalOptions="Center"/>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
